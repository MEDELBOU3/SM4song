<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Weather Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #FFFFFF;
            --card-bg: #1E1E1E;
            --sidebar-bg: #2A2A2A;
            --hover-color: rgba(255, 255, 255, 0.1);
            --chart-bg: rgba(76, 175, 80, 0.2);
            --chart-border: rgba(76, 175, 80, 1);
            --map-filter: invert(1);
        }

        .light-mode {
            --bg-color: #F0F0F0;
            --text-color: #333333;
            --card-bg: #FFFFFF;
            --sidebar-bg: #E0E0E0;
            --hover-color: rgba(0,0,0,0.1);
            --chart-bg: rgba(76, 175, 80, 0.2);
            --chart-border: rgba(76, 175, 80, 1);
            --map-filter: none;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 20px;
            max-width: 1300px;
            width: 95%;
            background-color: var(--card-bg);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .sidebar:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--hover-color);
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .forecast {
            display: flex;
            justify-content: space-between;
            background-color: var(--sidebar-bg);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .forecast:hover {
            transform: scale(1.02);
        }

        .forecast-day {
            text-align: center;
            transition: all 0.3s ease;
        }

        .forecast-day:hover {
            transform: translateY(-5px);
        }

        .map-container {
            background-color: var(--sidebar-bg);
            border-radius: 20px;
            padding: 25px;
            height: 350px;
            transition: all 0.3s ease;
        }

        .map-container:hover {
            transform: scale(1.02);
        }

        .map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            <!-- filter: var(--map-filter); -->
        }

        .map-point {
            width: 12px;
            height: 12px;
            background-color: #4CAF50;
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 10px #4CAF50;
            transition: all 0.3s ease;
        }

        .map-point:hover {
            transform: scale(1.5);
        }

        .current-weather {
            font-size: 64px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .current-weather:hover {
            transform: scale(1.05);
        }

        .weather-icon {
            font-size: 48px;
            margin-right: 20px;
        }

        .details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            background-color: var(--sidebar-bg);
            box-shadow: 0 5px 15px var(--hover-color);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .detail-item:hover {
            transform: translateY(-5px);
            box-shadow: none;
        }

        .detail-icon {
            margin-right: 15px;
            font-size: 28px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            outline: none;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: 10px;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            background-color: #4CAF50;
            color: #FFFFFF;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #45a049;
        }

        h2, h3 {
            margin-bottom: 20px;
            color: #4CAF50;
        }

        #cityName {
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }

        #dateTime {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            color: #BBBBBB;
        }

        .air-quality {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--sidebar-bg);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .air-quality:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--hover-color);
        }

        #aqiValue {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }

        .chart-container {
            background-color: var(--sidebar-bg);
            border-radius: 20px;
            padding: 25px;
            height: 300px;
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            transform: scale(1.02);
        }

        #toggleMode {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px; /* Increased width to accommodate the icon */
            height: 40px; /* Increased height to accommodate the icon */
            padding: 0; /* Removed padding */
            background-color: var(--bg-color);
            border: none;
            box-shadow: 0 1rem 1.4rem var(--hover-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex; /* Added flex display */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
        }

        #toggleMode i {
            font-size: 18px;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <button id="toggleMode"><i class="fas fa-moon"></i></button>
    <div class="dashboard">
        <div class="sidebar">
            <h2>Weather App</h2>
            <input type="text" id="cityInput" placeholder="Search city...">
            <button onclick="getWeather()">Search</button>
            <div id="cityName"></div>
            <div id="dateTime"></div>
        </div>
        <div class="main-content">
            <div class="current-weather">
                <i class="fas fa-sun weather-icon" id="weatherIcon"></i>
                <span id="temperature">--°C</span>
            </div>
            <div class="forecast" id="forecast">
                <!-- Forecast data will be inserted here -->
            </div>
            <div class="chart-container">
                <canvas id="tempChart"></canvas>
            </div>
            <div class="map-container">
                <div class="map" id="map">
                    <!-- Map will be inserted here -->
                </div>
            </div>
        </div>
        <div class="sidebar">
            <h3>Weather Details</h3>
            <div class="details">
                <div class="detail-item">
                    <i class="fas fa-tint detail-icon"></i>
                    <span>Humidity: <span id="humidity">--%</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-wind detail-icon"></i>
                    <span>Wind: <span id="windSpeed">-- km/h</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-thermometer-half detail-icon"></i>
                    <span>Feels like: <span id="feelsLike">--°C</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-cloud detail-icon"></i>
                    <span>Cloudiness: <span id="cloudiness">--%</span></span>
                </div>
            </div>
            <div class="air-quality">
                <h3>Air Quality Index</h3>
                <div id="aqiValue">--</div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = 'f458a708df95ee78be02eb6eb535560e';
        const apiUrl = 'https://api.openweathermap.org/data/2.5/weather';
        const forecastUrl = 'https://api.openweathermap.org/data/2.5/forecast';
        const airQualityUrl = 'https://api.openweathermap.org/data/2.5/air_pollution';
        let chart;

        async function getWeather() {
            const cityName = document.getElementById('cityInput').value;
            if (!cityName) {
                alert('Please enter a city name');
                return;
            }

            try {
                const response = await fetch(`${apiUrl}?q=${cityName}&appid=${apiKey}&units=metric`);
                const data = await response.json();

                if (data.cod === '404') {
                    alert('City not found');
                    return;
                }

                updateWeatherInfo(data);
                getForecast(cityName);
                updateMap(data.coord.lat, data.coord.lon);
                getAirQuality(data.coord.lat, data.coord.lon);
                updateCityAndTime(data.name, data.timezone);
            } catch (error) {
                console.error('Error fetching weather data:', error);
                alert('An error occurred while fetching weather data');
            }
        }

        function updateWeatherInfo(data) {
            document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}°C`;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('windSpeed').textContent = `${data.wind.speed} km/h`;
            document.getElementById('feelsLike').textContent = `${Math.round(data.main.feels_like)}°C`;
            document.getElementById('cloudiness').textContent = `${data.clouds.all}%`;
            updateWeatherIcon(data.weather[0].id);
        }

        function updateWeatherIcon(weatherId) {
            const iconElement = document.getElementById('weatherIcon');
            iconElement.className = 'fas';
            if (weatherId >= 200 && weatherId < 300) iconElement.classList.add('fa-bolt');
            else if (weatherId >= 300 && weatherId < 500) iconElement.classList.add('fa-cloud-rain');
            else if (weatherId >= 500 && weatherId < 600) iconElement.classList.add('fa-umbrella');
            else if (weatherId >= 600 && weatherId < 700) iconElement.classList.add('fa-snowflake');
            else if (weatherId >= 700 && weatherId < 800) iconElement.classList.add('fa-smog');
            else if (weatherId === 800) iconElement.classList.add('fa-sun');
            else iconElement.classList.add('fa-cloud');
        }

        async function getForecast(cityName) {
            try {
                const response = await fetch(`${forecastUrl}?q=${cityName}&appid=${apiKey}&units=metric`);
                const data = await response.json();

                if (data.cod === '404') {
                    console.error('City not found for forecast');
                    return;
                }

                updateForecast(data.list);
                updateChart(data.list);
            } catch (error) {
                console.error('Error fetching forecast data:', error);
            }
        }

        function updateForecast(forecastData) {
            const forecastContainer = document.getElementById('forecast');
            forecastContainer.innerHTML = '';

            const dailyForecasts = forecastData.filter((item, index) => index % 8 === 0).slice(0, 5);

            dailyForecasts.forEach(day => {
                const date = new Date(day.dt * 1000);
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const iconClass = getWeatherIconClass(day.weather[0].id);
                const temp = Math.round(day.main.temp);

                const dayElement = document.createElement('div');
                dayElement.className = 'forecast-day';
                dayElement.innerHTML = `
                    <div>${dayName}</div>
                    <div><i class="fas ${iconClass}" style="font-size: 32px;"></i></div>
                    <div>${temp}°C</div>
                `;

                forecastContainer.appendChild(dayElement);
            });
        }

        function getWeatherIconClass(weatherId) {
            if (weatherId >= 200 && weatherId < 300) return 'fa-bolt';
            if (weatherId >= 300 && weatherId < 500) return 'fa-cloud-rain';
            if (weatherId >= 500 && weatherId < 600) return 'fa-umbrella';
            if (weatherId >= 600 && weatherId < 700) return 'fa-snowflake';
            if (weatherId >= 700 && weatherId < 800) return 'fa-smog';
            if (weatherId === 800) return 'fa-sun';
            return 'fa-cloud';
        }

        function updateMap(lat, lon) {
            const map = document.getElementById('map');
            map.innerHTML = `<iframe width="100%" height="100%" frameborder="0" style="border:0" 
                src="https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.1}%2C${lat-0.1}%2C${lon+0.1}%2C${lat+0.1}&amp;layer=mapnik&amp;marker=${lat}%2C${lon}" allowfullscreen></iframe>`;
        }

        async function getAirQuality(lat, lon) {
            try {
                const response = await fetch(`${airQualityUrl}?lat=${lat}&lon=${lon}&appid=${apiKey}`);
                const data = await response.json();
                const aqi = data.list[0].main.aqi;
                document.getElementById('aqiValue').textContent = getAQIDescription(aqi);
            } catch (error) {
                console.error('Error fetching air quality data:', error);
            }
        }

        function getAQIDescription(aqi) {
            switch(aqi) {
                case 1: return 'Good (1)';
                case 2: return 'Fair (2)';
                case 3: return 'Moderate (3)';
                case 4: return 'Poor (4)';
                case 5: return 'Very Poor (5)';
                default: return 'Unknown';
            }
        }

        function updateCityAndTime(city, timezone) {
            document.getElementById('cityName').textContent = city;
            const date = new Date();
            const localTime = new Date(date.getTime() + (timezone * 1000));
            document.getElementById('dateTime').textContent = localTime.toLocaleString();
        }

        function updateChart(forecastData) {
            const ctx = document.getElementById('tempChart').getContext('2d');
            const temperatures = forecastData.slice(0, 8).map(item => Math.round(item.main.temp));
            const labels = forecastData.slice(0, 8).map(item => {
                const date = new Date(item.dt * 1000);
                return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            });

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: temperatures,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Initialize with a default city
        window.onload = () => {
            document.getElementById('cityInput').value = 'London';
            getWeather();
        };

        // Update time every minute
        setInterval(() => {
            const cityName = document.getElementById('cityName').textContent;
            if (cityName) {
                getWeather();
            }
        }, 60000);

        // Toggle light/dark mode
        document.getElementById('toggleMode').addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            this.innerHTML = document.body.classList.contains('light-mode') ? 
                '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });
    </script>
</body>
</html>